"use strict";(self["webpackChunksave_world_web_tg_app"]=self["webpackChunksave_world_web_tg_app"]||[]).push([[891],{7197:function(t,s,a){a.d(s,{L:function(){return k}});var e=a(5234),o=a(4373),i=a(5903),l=a(2756),r=a(5628);const k=(0,e.nY)("tasks",{state:()=>({categories:[{cat_id:0,title:"Social",tasks:[{id:0,title:"Task 1",url:"https://vk.com/al_feed.php",status:"VERIFYING"},{id:1,title:"Tasks 2",url:"https://vk.com/al_feed.php",status:"CLAIMED"},{id:2,title:"Task 1",url:"https://vk.com/al_feed.php",status:"COMPLETED"},{id:3,title:"Tasks 2",url:"https://vk.com/al_feed.php",status:"NOT_STARTED"},{id:4,title:"Tasks 3",url:"https://vk.com/al_feed.php",status:"NOT_STARTED"}]},{cat_id:1,title:"Social 2",tasks:[{id:5,title:"Task 1",url:"https://vk.com/al_feed.php",status:"VERIFYING"},{id:6,title:"Tasks 2",url:"https://vk.com/al_feed.php",status:"CLAIMED"},{id:7,title:"Task 1",url:"https://vk.com/al_feed.php",status:"COMPLETED"},{id:8,title:"Tasks 2",url:"https://vk.com/al_feed.php",status:"NOT_STARTED"},{id:9,title:"Tasks 3",url:"https://vk.com/al_feed.php",status:"NOT_STARTED"}]},{cat_id:2,title:"Social 3",tasks:[{id:10,title:"Task 1",url:"https://vk.com/al_feed.php",status:"VERIFYING"},{id:11,title:"Tasks 2",url:"https://vk.com/al_feed.php",status:"CLAIMED"},{id:12,title:"Task 1",url:"https://vk.com/al_feed.php",status:"COMPLETED"}]}],promoTasks:[{promo_task_id:0,title:"Recycle",description:"Recycle 5 batteries.",promo_task_status:"NOT_STARTED",tasks:[{id:0,title:"Task 1",url:"https://vk.com/al_feed.php",status:"VERIFYING"},{id:1,title:"Tasks 2",url:"https://vk.com/al_feed.php",status:"CLAIMED"},{id:2,title:"Task 1",url:"https://vk.com/al_feed.php",status:"COMPLETED"},{id:3,title:"Tasks 2",url:"https://vk.com/al_feed.php",status:"NOT_STARTED"},{id:4,title:"Tasks 3",url:"https://vk.com/al_feed.php",status:"NOT_STARTED"}]},{promo_task_id:1,title:"Animals",description:"Recycle 5 batteries.",promo_task_status:"NOT_STARTED",tasks:[{id:5,title:"Task 1",url:"https://vk.com/al_feed.php",status:"VERIFYING"},{id:6,title:"Tasks 2",url:"https://vk.com/al_feed.php",status:"CLAIMED"},{id:7,title:"Task 1",url:"https://vk.com/al_feed.php",status:"COMPLETED"},{id:8,title:"Tasks 2",url:"https://vk.com/al_feed.php",status:"NOT_STARTED"},{id:9,title:"Tasks 3",url:"https://vk.com/al_feed.php",status:"NOT_STARTED"}]}]}),actions:{async fetchTasks(){try{const t=(0,l.v)().ensureWebAppData(),s=await o.A.post(`${i.$.backendURL}/api/cards/get-karma`,t);(0,r.B)(s),this.categories=s.data.data.tasks,this.promoTasks=s.data.data.promoTasks}catch(t){throw console.error("Ошибка при получении заданий:",t),new Error("Server error when getting tasks list")}},acceptTask(t){const s=this.categories.find((s=>s.tasks.some((s=>s.id===t.id))));if(s){const a=s.tasks.find((s=>s.id===t.id));a&&(a.status="VERIFYING",setTimeout((()=>{a.status="COMPLETED"}),5e3))}},acceptPromoTask(t){const s=this.promoTasks.find((s=>s.tasks.some((s=>s.id===t.id))));if(s){const a=s.tasks.find((s=>s.id===t.id));if(a){a.status="VERIFYING",s.promo_task_status="IN_PROGRESS",setTimeout((()=>{a.status="COMPLETED"}),5e3);let t=!0;s.tasks.forEach((s=>{"COMPLETED"===s.status||(t=!1)})),t&&(s.promo_task_status="COMPLETED")}}},claimPromoTaskReward(t){const s=this.promoTasks.find((s=>s.promo_task_id===t.promo_task_id));s&&(t.promo_task_status="CLAIMED")},claimReward(t){const s=this.categories.find((s=>s.tasks.some((s=>s.id===t.id))));if(s){const a=s.tasks.find((s=>s.id===t.id));a&&(a.status="CLAIMED")}},async joinQuest(t){const s=await o.A.post(i.$.backendURL+"/orders/join-quest",{quest:t,withCredentials:!0});if(201!==s.status)throw new Error("Не удалось создать обращение. Неправильный статус ответа от сервера: "+s.status)}},getters:{}})},9602:function(t,s,a){a.d(s,{A:function(){return E}});var e=a(6768),o=a(4232),i=a(144),l=a.p+"img/battery.e2012877.svg",r=a(4462),k=a(7197),c=a(5234),p=a(5931);const d={class:"task-item"},u={class:"left-side"},n={class:"info"},_={key:0,class:"loader-wrapper"},T={key:1,class:"claimed-wrapper"};var m=(0,e.pM)({__name:"TaskItem",props:{task:{},isPromoTask:{type:Boolean}},setup(t){const{t:s,locale:a}=(0,p.s9)(),m=(0,k.L)(),h=t,{categories:v}=(0,c.bP)(m),E=(0,e.EW)((()=>{const t=v.value.find((t=>t.tasks.some((t=>t.id===h.task.id)))),s=t?.tasks.find((t=>t.id===h.task.id));return s||h.task})),f=async()=>{try{window.open(E.value.url,"_blank"),m.acceptTask(E.value)}catch(t){return void console.error(t)}},L=async()=>{try{m.claimReward(E.value)}catch(t){return void console.error(t)}};return(t,a)=>((0,e.uX)(),(0,e.CE)("div",d,[(0,e.Lk)("div",u,[a[1]||(a[1]=(0,e.Lk)("img",{src:l,alt:""},null,-1)),(0,e.Lk)("div",n,[(0,e.Lk)("h3",null,(0,o.v_)(E.value.title),1),a[0]||(a[0]=(0,e.Lk)("div",{class:"income"},[(0,e.Lk)("p",null,"+ 699"),(0,e.Lk)("img",{src:r,alt:""})],-1))])]),"VERIFYING"===E.value.status?((0,e.uX)(),(0,e.CE)("div",_,a[2]||(a[2]=[(0,e.Lk)("div",{class:"loader"},null,-1)]))):(0,e.Q3)("",!0),"CLAIMED"===E.value.status?((0,e.uX)(),(0,e.CE)("div",T,[(0,e.Lk)("p",null,(0,o.v_)((0,i.R1)(s)("completed")),1)])):"NOT_STARTED"===E.value.status?((0,e.uX)(),(0,e.CE)("button",{key:2,onClick:f},(0,o.v_)((0,i.R1)(s)("accept-task")),1)):"COMPLETED"===E.value.status?((0,e.uX)(),(0,e.CE)("button",{key:3,onClick:L},(0,o.v_)((0,i.R1)(s)("claim-task")),1)):(0,e.Q3)("",!0)]))}}),h=a(1241);const v=(0,h.A)(m,[["__scopeId","data-v-46cf3497"]]);var E=v},7764:function(t,s,a){a.r(s),a.d(s,{default:function(){return I}});var e=a(6768),o=a(7016),i=a(3981),l=a(4232),r=a(144),k=a(9602),c=a(5234),p=a(7197),d=a(2225),u=a(1459);const n={class:"promo-task"},_={class:"container"},T={class:"promo-task-content"},m={class:"task-category__tasks"};var h=(0,e.pM)({__name:"PromoTaskSection",props:{promoTaskID:{}},emits:["clicked"],setup(t,{emit:s}){const a=t,o=(0,p.L)(),{promoTasks:i}=(0,c.bP)(o),h=i.value.find((t=>t.promo_task_id===Number(a.promoTaskID)));return(0,e.sV)((()=>{d.B.emit("toggleHeaderBackBtnVisibility",!0),d.B.on("headerBackBtnPressed",(()=>{u.A.back()}))})),(0,e.xo)((()=>{d.B.emit("toggleHeaderBackBtnVisibility",!1),d.B.off("headerBackBtnPressed")})),(t,s)=>((0,e.uX)(),(0,e.CE)("section",n,[(0,e.Lk)("div",_,[(0,e.Lk)("div",T,[(0,e.Lk)("h2",null,(0,l.v_)(t.t("promo-tasks")),1),(0,e.Lk)("div",m,[((0,e.uX)(!0),(0,e.CE)(e.FK,null,(0,e.pI)((0,r.R1)(h).tasks,((t,s)=>((0,e.uX)(),(0,e.Wv)(k.A,{class:"task-category__task",key:s,task:t,isPromoTask:!0},null,8,["task"])))),128))])])])]))}}),v=a(1241);const E=(0,v.A)(h,[["__scopeId","data-v-2c4ae955"]]);var f=E,L=a(1387),D=(0,e.pM)({__name:"PromoTaskView",setup(t){const s=(0,L.lq)(),a=(0,r.KR)(s.params.promo_task_id);return(0,e.sV)((()=>{console.log(s.params.promo_task_id)})),(t,s)=>((0,e.uX)(),(0,e.CE)(e.FK,null,[(0,e.bF)(o.A),(0,e.Lk)("main",null,[(0,e.bF)(f,{promoTaskID:a.value},null,8,["promoTaskID"])]),(0,e.bF)(i.A)],64))}});const R=D;var I=R},4462:function(t,s,a){t.exports=a.p+"img/green-coin.5547f652.svg"}}]);
//# sourceMappingURL=891.9f090624.js.map